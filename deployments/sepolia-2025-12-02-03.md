# ECS V2 Sepolia Deployment - 2025-12-02-03

**Date:** December 2, 2025  
**Network:** Sepolia Testnet (Chain ID: 11155111)  
**Deployment Number:** 03 (Clean deployment with correct owner setup)

## Changes from Deployment 02

Fixed the `CredentialResolver` owner issue:
- Updated script to explicitly compute deployer address from private key using `vm.addr()`
- Pass explicit `deployerAddress` to `CredentialResolver` constructor instead of relying on `msg.sender`
- Verified owner matches deployer: `0xF8e03bd4436371E0e2F7C02E529b2172fe72b4EF`

## Deployed Contracts

| Contract | Address |
|----------|---------|
| ECS Registry | `0x016BfbF42131004401ABdfe208F17A1620faB742` |
| ECS Registrar | `0x7aDf2626E846aC3a36ac72f25B8329C893b45e12` |
| Credential Resolver | `0x03eb9Bf23c828E3891A8fE3cB484A7ca769B985e` |

## Configuration

- **Root Name:** `ecs.eth`
- **Root Node:** `0xe436ba58406c69a63a9611a11eb52314c5c17ba9eaaa7dab8506fe8849517286`
- **Deployer Address:** `0xF8e03bd4436371E0e2F7C02E529b2172fe72b4EF` ✅
- **CredentialResolver Owner:** `0xF8e03bd4436371E0e2F7C02E529b2172fe72b4EF` ✅ (matches!)
- **Registrar Pricing:** ~0.001 ETH/year (32000 wei/second)
- **Min Commitment Age:** 60 seconds
- **Min Duration:** 60 seconds
- **Max Duration:** `type(uint64).max`
- **Min Label Length:** 3
- **Max Label Length:** 64

## Registration Status

### name-stars.ecs.eth

- **Label:** `name-stars`
- **Duration:** 365 days
- **Commitment Hash:** `0xabfe8d6be7052d65504d94cd16858998f0172b96b18423dc438aca63ed8830b6`
- **Secret:** `0x5338c9729ec2472c0eb5dad4ae22a62b88dc3e8fa31238b87017567874257891`
- **Status:** ✅ **REGISTERED** (Registration complete!)
- **Owner:** `0xF8e03bd4436371E0e2F7C02E529b2172fe72b4EF`
- **Resolver:** `0x03eb9Bf23c828E3891A8fE3cB484A7ca769B985e`

#### Credential Records Set

- **Key:** `eth.ecs.name-stars.starts:vitalik.eth`
- **Text Value:** `"100"`
- **Data Value:** `0x0000000000000000000000000000000000000000000000000000000000000064` (uint256: 100)
- **Status:** ✅ Records successfully set

## Environment Variables

Add these to your `.env` file for use with `RegisterAndSetup.s.sol`:

```bash
ECS_REGISTRY_ADDRESS=0x016BfbF42131004401ABdfe208F17A1620faB742
ECS_REGISTRAR_ADDRESS=0x7aDf2626E846aC3a36ac72f25B8329C893b45e12
CREDENTIAL_RESOLVER_ADDRESS=0x03eb9Bf23c828E3891A8fE3cB484A7ca769B985e
ROOT_NODE=0xe436ba58406c69a63a9611a11eb52314c5c17ba9eaaa7dab8506fe8849517286
REGISTRATION_SECRET=0x5338c9729ec2472c0eb5dad4ae22a62b88dc3e8fa31238b87017567874257891
```

## Deployment Status

✅ **DEPLOYMENT COMPLETE**

All steps successfully executed:
1. ✅ Deployed ECS Registry, Registrar, and Credential Resolver
2. ✅ Set `ecs.eth` manager to ECS Registry address
3. ✅ Registered `name-stars.ecs.eth` label
4. ✅ Set credential records on Credential Resolver

## How to Query Records

You can now query the credential records:

### Via ENS Resolution

```bash
# Get the resolver for name-stars.ecs.eth
cast call 0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e "resolver(bytes32)" \
  0x2ef7af5e00b59ac704e77af38a4b06b8bea8b97905b89fe4fceb672c72fbd2b9 \
  --rpc-url https://eth-sepolia.g.alchemy.com/v2/0rXVfxycbHEigHX96u1p-G02VKeV2AS5
```

### Via Credential Resolver

```bash
# Query text record
cast call 0x03eb9Bf23c828E3891A8fE3cB484A7ca769B985e \
  "text(bytes32,string)(string)" \
  0x0000000000000000000000000000000000000000000000000000000000000000 \
  "eth.ecs.name-stars.starts:vitalik.eth" \
  --rpc-url https://eth-sepolia.g.alchemy.com/v2/0rXVfxycbHEigHX96u1p-G02VKeV2AS5

# Query data record
cast call 0x03eb9Bf23c828E3891A8fE3cB484A7ca769B985e \
  "data(bytes32,string)(bytes)" \
  0x0000000000000000000000000000000000000000000000000000000000000000 \
  "eth.ecs.name-stars.starts:vitalik.eth" \
  --rpc-url https://eth-sepolia.g.alchemy.com/v2/0rXVfxycbHEigHX96u1p-G02VKeV2AS5
```

## Verification

- **Explorer:** [Sepolia Etherscan](https://sepolia.etherscan.io/)
- **Registry:** [0x016BfbF42131004401ABdfe208F17A1620faB742](https://sepolia.etherscan.io/address/0x016BfbF42131004401ABdfe208F17A1620faB742)
- **Registrar:** [0x7aDf2626E846aC3a36ac72f25B8329C893b45e12](https://sepolia.etherscan.io/address/0x7aDf2626E846aC3a36ac72f25B8329C893b45e12)
- **Resolver:** [0x03eb9Bf23c828E3891A8fE3cB484A7ca769B985e](https://sepolia.etherscan.io/address/0x03eb9Bf23c828E3891A8fE3cB484A7ca769B985e)

## Architecture Notes

- **Single-label CredentialResolver**: One resolver per label (e.g., `name-stars.ecs.eth`)
- **Owner-only access**: Only the deployer can set records on the `CredentialResolver`
- **Simplified storage**: No labelhash parameters needed
- **Fixed owner mismatch**: Explicitly passes deployer address to constructor

## Deployment Timeline

1. **2025-12-02 - Deployment #01**: Initial deployment (had owner mismatch issue)
2. **2025-12-02 - Deployment #02**: Clean redeployment with simplified CredentialResolver (still had owner issue)
3. **2025-12-02 - Deployment #03**: Fixed deployment with correct owner setup ✅
   - Fixed script to explicitly compute deployer address
   - Successfully registered `name-stars.ecs.eth`
   - Successfully set credential records

## Transaction Costs

### Deployment (DeployAndCommit)
- **Gas Used**: 9,562,433 gas
- **Gas Price**: 0.001000017 gwei
- **Total Cost**: ~0.0000096 ETH

### Registration (RegisterAndSetup)
- **Gas Used**: 461,642 gas
- **Gas Price**: 0.001000012 gwei
- **Total Cost**: ~0.00000046 ETH

**Total Deployment Cost**: ~0.0000100 ETH (~$0.025 USD)

## Summary

This deployment represents the finalized **ECS V2** architecture with:
- Simplified single-label credential resolvers
- Direct ENS Registry integration (no custom resolver layer)
- Owner-based access control
- Full compatibility with ENS Hooks standard
- Successful end-to-end deployment and testing on Sepolia

All 21 unit tests passing ✅  
Integration complete ✅  
Ready for production deployment ✅

