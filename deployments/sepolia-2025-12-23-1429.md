# ECS V2 Deployment Report - Sepolia Testnet

**Deployment Date:** 2025-12-23 14:29:38 UTC  
**Network:** Sepolia Testnet (Chain ID: 11155111)  
**Version:** v0.2.2-beta  
**Architecture:** Ownable + ERC-8049 Clone Pattern

---

## Overview

This deployment includes the ECS (Ethereum Credential System) protocol contracts with the following key improvements:
- Switched from `OwnableUpgradeable` to `Ownable` for minimal clones
- Integrated ERC-8049 for contract-level metadata storage
- Uses OpenZeppelin's `Initializable` for initialization guards
- Factory pattern for gas-efficient clone deployments

---

## Deployed Contracts

### Core Contracts

| Contract | Address | Etherscan |
|----------|---------|-----------|
| **ECS Registry** | `0x1Cc0E6c3B645D7751DE7Ff7ce7d17cD228e4a4F2` | [View](https://sepolia.etherscan.io/address/0x1Cc0E6c3B645D7751DE7Ff7ce7d17cD228e4a4F2) |
| **ECS Registrar** | `0x86a67901820da1e3523Db67d02083C0a08170b37` | [View](https://sepolia.etherscan.io/address/0x86a67901820da1e3523Db67d02083C0a08170b37) |
| **CredentialResolver Implementation** | `0x7F7e3EA29fd74cfA4672eD2F1995d7DD6988d06f` | [View](https://sepolia.etherscan.io/address/0x7F7e3EA29fd74cfA4672eD2F1995d7DD6988d06f) |
| **CredentialResolverFactory** | `0xb5b31DEb61f6b9Dd61b222ad50084e11EF53B8E3` | [View](https://sepolia.etherscan.io/address/0xb5b31DEb61f6b9Dd61b222ad50084e11EF53B8E3) |

### Deployed Clone

| Contract | Address | Etherscan |
|----------|---------|-----------|
| **CredentialResolver Clone** | `0x48A3D8Cec7807eDB1ba78878c356B3D051278891` | [View](https://sepolia.etherscan.io/address/0x48A3D8Cec7807eDB1ba78878c356B3D051278891) |

**Note:** The CredentialResolver clone is a minimal proxy (EIP-1167) pointing to the implementation contract. All clones share the same implementation code but have independent storage.

---

## Configuration

### Root Domain
- **Root Name:** `ecs.eth`
- **Root Node:** `0xe436ba58406c69a63a9611a11eb52314c5c17ba9eaaa7dab8506fe8849517286`
- **ENS Registry:** `0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e` (Standard ENS Registry)

### Registrar Settings
- **Min Duration:** 60 seconds
- **Max Duration:** `type(uint64).max`
- **Min Label Length:** 3 characters
- **Max Label Length:** 64 characters
- **Pricing:** 32,000 wei per second (~0.001 ETH/year)

### Deployer Information
- **Deployer Address:** `0xF8e03bd4436371E0e2F7C02E529b2172fe72b4EF`
- **CredentialResolver Clone Owner:** `0xF8e03bd4436371E0e2F7C02E529b2172fe72b4EF`

---

## Registration Details

### Test Registration
- **Label:** `name-stars`
- **Full Name:** `name-stars.ecs.eth`
- **Duration:** 365 days
- **Expiration:** Block timestamp `1798054104` (~2027-01-07)
- **Registration Cost:** 1,009,152,000,000 wei (~0.001 ETH)
- **Owner:** `0x1804c8AB1F12E6bbf3894d4083f33e07309d1f38`

### Credential Records Set

#### Text Record
- **Key:** `eth.ecs.name-stars.starts:vitalik.eth`
- **Value:** `"100"`

#### ERC-8049 Metadata Record
- **Key:** `eth.ecs.name-stars.starts:vitalik.eth`
- **Value:** `100` (uint256 encoded)

---

## Contract Verification

All contracts have been verified on Etherscan:

âœ… **ECS Registry** - Verified  
âœ… **ECS Registrar** - Verified  
âœ… **CredentialResolver Implementation** - Verified  
âœ… **CredentialResolverFactory** - Verified

---

## Key Features

### 1. Minimal Clone Pattern
- Uses EIP-1167 minimal proxy pattern for gas-efficient deployments
- Each clone shares implementation code but has independent storage
- Factory contract manages clone creation and tracking

### 2. ERC-8049 Integration
- Contract-level metadata storage using ERC-8049 standard
- `setContractMetadata()` function for setting metadata
- `getContractMetadata()` function for reading metadata
- `data()` ENS resolver function delegates to ERC-8049 storage

### 3. Initialization Security
- Implementation contract has initializers disabled in constructor
- Clones can only be initialized once using OpenZeppelin's `Initializable`
- Zero address validation prevents invalid ownership

### 4. Ownership Model
- Uses standard `Ownable` (not upgradeable) for minimal clones
- Owner can set resolver records (text, addr, contenthash, metadata)
- Factory validates owner address before deployment

---

## Gas Costs

### Deployment Costs
- **ECS Registry:** ~2,604,852 gas
- **ECS Registrar:** ~2,305,440 gas
- **CredentialResolver Implementation:** ~2,116,439 gas
- **CredentialResolverFactory:** ~639,512 gas
- **CredentialResolver Clone:** ~160,106 gas (including initialization)

**Total Deployment:** ~7,826,349 gas

### Registration Costs
- **Name Registration:** ~145,044 gas
- **Set Text Record:** ~31,371 gas
- **Set Contract Metadata:** ~55,021 gas

**Total Registration:** ~231,436 gas

---

## Environment Variables

For use in scripts and tests, set these environment variables:

```bash
# Contract Addresses
export ECS_REGISTRY_ADDRESS=0x1Cc0E6c3B645D7751DE7Ff7ce7d17cD228e4a4F2
export ECS_REGISTRAR_ADDRESS=0x86a67901820da1e3523Db67d02083C0a08170b37
export CREDENTIAL_RESOLVER_IMPLEMENTATION=0x7F7e3EA29fd74cfA4672eD2F1995d7DD6988d06f
export CREDENTIAL_RESOLVER_FACTORY=0xb5b31DEb61f6b9Dd61b222ad50084e11EF53B8E3
export CREDENTIAL_RESOLVER_ADDRESS=0x48A3D8Cec7807eDB1ba78878c356B3D051278891

# Configuration
export ROOT_NODE=0xe436ba58406c69a63a9611a11eb52314c5c17ba9eaaa7dab8506fe8849517286
export REGISTRATION_SECRET=0x740d41acb379fe8e7cd711b382430463ad7ab2150c9284af149bd78817df4d01
export PUBLIC_DEPLOYER_ADDRESS=0xF8e03bd4436371E0e2F7C02E529b2172fe72b4EF
```

---

## Deployment Scripts

### Step 1: Deploy and Commit
```bash
forge script script/DeployAndCommit.s.sol:DeployAndCommit \
  --rpc-url $SEPOLIA_RPC_URL \
  --broadcast \
  --verify
```

### Step 2: Register and Setup
```bash
# After setting manager of ecs.eth to ECS Registry address
forge script script/RegisterAndSetup.s.sol:RegisterAndSetup \
  --rpc-url $SEPOLIA_RPC_URL \
  --broadcast
```

---

## Important Notes

1. **ENS Manager Update Required:** The manager of `ecs.eth` must be set to the ECS Registry address (`0x1Cc0E6c3B645D7751DE7Ff7ce7d17cD228e4a4F2`) before registrations can succeed.

2. **Commitment Period:** Registrations require a minimum 60-second commitment period before they can be revealed.

3. **Clone Initialization:** Each clone must be initialized exactly once with a non-zero owner address.

4. **ERC-8049 Storage:** Metadata is stored using ERC-8049's diamond storage pattern, ensuring no storage collisions.

---

## Testing

All contracts have been tested and verified:
- âœ… Unit tests passing (81 tests)
- âœ… Integration tests passing
- âœ… Factory clone deployment tests passing
- âœ… ERC-8049 interface support verified

---

## Next Steps

1. Monitor contract interactions on Etherscan
2. Test resolver functionality with ENS resolution
3. Deploy additional clones as needed via factory
4. Update documentation with production addresses when ready

---

## Support

For issues or questions:
- Contract source code: [GitHub Repository](https://github.com/nxt3d/ecs)
- Etherscan verification: All contracts verified and source code available

---

**Deployment completed successfully!** ðŸŽ‰
